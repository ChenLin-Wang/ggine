<!DOCTYPE html><html><head><title>Noble City</title><style>html,body{background-color:#111;width:100%;height:100%;margin:0;padding:0;overflow:hidden;display:flex;justify-content:center;align-items:center;}canvas{display:block;image-rendering:pixelated;object-fit:contain;box-shadow:0 0 30px #000}</style></head><body><canvas id="game"></canvas><script>(()=>{var j=class{x=0;y=0;get w(){return this.dom.width}set w(t){this.dom.width=t}get h(){return this.dom.height}set h(t){this.dom.height=t}set s(t){this.sx=t,this.sy=t}sx=1;sy=1;def={bz:1};cursor="default";render(t={},...i){let s=this._eng;for(let r of i){this._ctx.save();let e={};Object.assign(e,this.def,t,r);let n=(...c)=>c.filter(L=>L!=null)[0],a=s.inp;(e.click||e.hover)&&e.p!=null&&a.over(e.p,[e.x||0,e.y||0],e.c)&&(e.hover&&e.hover(e),a.click()&&e.click&&e.click(e)),e.cur&&(this.cursor=e.cur),e.aud&&e.aud in s.audios&&(s.audios[e.aud].active=!0,s.audios[e.aud].volume=n(e.vol,this.def.vol,1));let l=e.f!=null&&!(e.f in s.imgs),d=e.b!=null&&!(e.b in s.imgs),h=e.crop!=null&&e.crop.length==4;l&&(this._ctx.fillStyle=e.f),d&&(this._ctx.strokeStyle=e.b),this._ctx.lineCap=e.be=="arc"?"round":e.be=="sqr"?"square":"butt",this._ctx.lineJoin=e.bj=="arc"?"round":e.bj=="sqr"?"bevel":"miter",this._ctx.lineWidth=n(e.bz,this.def.bz,1),this._ctx.globalAlpha=n(e.a,this.def.a,1),this._ctx.save();let o=n(e.c,this.def.c,1),f=Math.pow(this.sx,o),m=Math.pow(this.sy,o),p=n(e.sx,e.s,this.def.sx,this.def.s,1),y=n(e.sy,e.s,this.def.sy,this.def.s,1);p*=f,y*=m;let k=0,v=1;e.r&&(k=Math.sin(e.r),v=Math.cos(e.r)),this._ctx.transform(p*v,p*k,-y*k,y*v,this.w/2*o*Math.pow(this.sx,o-1)+this.x*(1-o-f)+(e.x||0)*f,this.h/2*o*Math.pow(this.sy,o-1)+this.y*(1-o-m)+(e.y||0)*m),e.m&&e.m.length==6?this._ctx.transform.apply(this._ctx,e.m):e.m&&s.error_add(new Error(`Invalid transform [${e.m.toString()}]`)),this._ctx.textAlign="left",this._ctx.textBaseline="top";let b=[0,0];(!e.o||!e.o.includes("w")&&!e.o.includes("e"))&&(e.crop&&h?b[0]-=e.crop[2]/2:e.f&&!l&&(b[0]-=s.imgs[e.f].width/2),this._ctx.textAlign="center"),(!e.o||!e.o.includes("n")&&!e.o.includes("s"))&&(e.crop&&h?b[1]-=e.crop[3]/2:e.f&&!l&&(b[1]-=s.imgs[e.f].height/2),this._ctx.textBaseline="middle"),e.o&&e.o.includes("e")&&(e.crop&&h?b[0]-=e.crop[2]:e.f&&!l&&(b[0]-=s.imgs[e.f].width),this._ctx.textAlign="end"),e.o&&e.o.includes("s")&&(e.crop&&h?b[1]-=e.crop[3]:e.f&&!l&&(b[1]-=s.imgs[e.f].width),this._ctx.textBaseline="bottom"),this._ctx.translate(b[0],b[1]),e.f!=null&&e.f in s.imgs&&(e.crop&&h?this._ctx.drawImage(s.imgs[e.f],e.crop[0],e.crop[1],e.crop[2],e.crop[3],0,0,e.crop[2],e.crop[3]):this._ctx.drawImage(s.imgs[e.f],0,0),d&&e.p==null&&(e.crop&&h?this._ctx.strokeRect(0,0,e.crop[2],e.crop[3]):this._ctx.strokeRect(0,0,s.imgs[e.f].width,s.imgs[e.f].height)));let O=this._ctx.textAlign,A=this._ctx.textBaseline;if(this._ctx.restore(),this._ctx.textAlign=O,this._ctx.textBaseline=A,this._ctx.transform(f*v,f*k,-m*k,m*v,this.w/2*o*Math.pow(this.sx,o-1)+this.x*(1-o-f)+(e.x||0)*f,this.h/2*o*Math.pow(this.sy,o-1)+this.y*(1-o-m)+(e.y||0)*m),e.p){let c=0,L=0;this._ctx.beginPath();for(let g of e.p)g.length==2&&!c?this._ctx.moveTo(g[0],g[1]):g.length==2&&L==1?(this._ctx.lineTo(e.p[c-2][0]+g[0],e.p[c-2][1]),this._ctx.lineTo(e.p[c-2][0]+g[0],e.p[c-2][1]+g[1]),this._ctx.lineTo(e.p[c-2][0],e.p[c-2][1]+g[1])):g.length==2?this._ctx.lineTo(g[0],g[1]):g.length==0&&c>0&&e.p[c-1].length==2&&c+1!=e.p.length&&e.p[c+1].length==2?L=1:g.length==0&&c+1==e.p.length&&this._ctx.closePath(),c++;l&&this._ctx.fill(),d&&this._ctx.stroke()}e.t&&(this._ctx.font=`${e.tz!=null?e.tz:20}px ${n(e.tf==null?void 0:s.fonts[e.tf],e.tf,this.def.tf,"Arial")}`,l||(this._ctx.fillStyle="#000"),(!l&&!d||l)&&this._ctx.fillText(e.t,0,0),d&&this._ctx.strokeText(e.t,0,0)),this._ctx.restore()}}clear(){this._ctx.clearRect(0,0,this.w,this.h)}fit=!1;fitfull(){let{width:t,height:i}=(this.dom.parentElement||this.dom).getBoundingClientRect(),s=this.w/this.h;t/i>s?(this.dom.style.width="auto",this.dom.style.height="100%"):(this.dom.style.width="100%",this.dom.style.height="auto")}tile(t){let i=t.sx!=null?t.sx:t.s!=null?t.s:this.def.sx!=null?this.def.sx:this.def.s!=null?this.def.s:1,s=t.sy!=null?t.sy:t.s!=null?t.s:this.def.sy!=null?this.def.sy:this.def.s!=null?this.def.s:1,r=this.dom.getBoundingClientRect(),e=r.width/this.w,n=r.height/this.h;!t.f||!(t.f in this._eng.imgs)?t.f!=null&&(this.dom.style.background=t.f):(this.dom.style.backgroundImage=`url(${this._eng.base}${t.f})`,this.dom.style.backgroundPosition=`calc(50% + ${((t.x||0)-this.x)*this.sx*e}px) calc(50% + ${((t.y||0)-this.y)*this.sy*n}px)`,this.dom.style.backgroundSize=`${this._eng.imgs[t.f].width*this.sx*i}px ${this._eng.imgs[t.f].height*this.sy*s}px`)}dom;scene=null;_ctx;_eng;constructor(t="",i,s=640,r=360){this.dom=typeof t!="string"?t:t.length&&document.querySelector(t)?document.querySelector(t):document.createElement("canvas"),this.dom.style.aspectRatio=`${s} / ${r}`,this.w=s,this.h=r,this._ctx=this.dom.getContext("2d"),this._ctx.imageSmoothingEnabled=!1,this._eng=i,i.cameras.push(this),i.inp.bind(this)}},z=class{x=0;_x=0;_gx=0;get dx(){return this.x-this._x}set dx(t){this._x=this.x-t}y=0;_y=0;_gy=0;get dy(){return this.y-this._y}set dy(t){this._y=this.y-t}rx=0;_rx=0;_grx=0;get drx(){return this.rx-this._rx}set drx(t){this._rx=this.rx-t}ry=0;_ry=0;_gry=0;get dry(){return this.ry-this._ry}set dry(t){this._ry=this.ry-t}b=0;_b=0;get db(){return this.b^this._b}set db(t){this._b=this.b^t}cb(t,i=null){return(this.db&t)!=0&&(i==null?(this.b&t)!=0:(this.b&t)==i)}sx=0;_sx=0;get dsx(){return this.sx-this._sx}set dsx(t){this._sx=this.sx-t}sy=0;_sy=0;get dsy(){return this.sy-this._sy}set dsy(t){this._sy=this.sy-t}get gx(){return this.x-this._gx}get gy(){return this.y-this._gy}get grx(){return this.rx-this._grx}get gry(){return this.ry-this._gry}get g(){return Math.hypot(this.gx,this.gy)}get gr(){return Math.hypot(this.grx,this.gry)}click(t=1){return this.g<t&&this.cb(1,0)}over(t,i=[0,0],s){let r=s??(this._cam.def.c!=null?this._cam.def.c:1),e=(this.x-this._cam.w/2*r+this._cam.x*r*this._cam.sx)*Math.pow(this._cam.sx,-r)-i[0],n=(this.y-this._cam.h/2*r+this._cam.y*r*this._cam.sy)*Math.pow(this._cam.sy,-r)-i[1],a=!1;for(let l=0,d=t.length-1;l<t.length;d=l++){let h=t[l].length==2&&t[d].length==2;if(l==0&&t[d].length==0&&d--,l!=0&&l+1<t.length&&t[l].length==0&&t[l-1].length==2&&t[l+1].length==2){let o=t[l-1][0],f=t[l-1][1],m=o+t[l+1][0],p=f+t[l+1][1];f>n!=p>n&&o>e!=m>e&&(a=!a),l++}else if(h){let o=t[l][0],f=t[l][1],m=t[d][0],p=t[d][1];f>n!=p>n&&e<(m-o)*(n-f)/(p-f)+o&&(a=!a)}}return a}in(...t){for(let i of t)if(this.x>i[0]&&this.x<i[0]+i[2]&&this.y>i[1]&&this.y<i[1]+i[3])return!0;return!1}rin(...t){for(let i of t)if(this.rx>i[0]&&this.rx<i[0]+i[2]&&this.ry>i[1]&&this.ry<i[1]+i[3])return!0;return!1}key={};dkey={};handle(t){if(t instanceof WheelEvent)this.sx+=t.deltaX,this.sy+=t.deltaY;else if(t instanceof MouseEvent){let i=this._cam.dom.getBoundingClientRect(),s=this._cam.w/this._cam.h,r=s>i.width/i.height?[i.width,i.width/s]:[i.height*s,i.height];this.x=(t.clientX-i.left-(i.width-r[0])/2)/r[0]*this._cam.w,this.y=(t.clientY-i.top-(i.height-r[1])/2)/r[1]*this._cam.h,this.rx=(this.x-this._cam.w/2+this._cam.x)/this._cam.sx,this.ry=(this.y-this._cam.h/2+this._cam.y)/this._cam.sy,this.b=t.buttons,this.cb(1)&&(this._gx=this.x,this._gy=this.y,this._grx=this.rx,this._gry=this.ry),t.preventDefault()}else t instanceof KeyboardEvent&&(t.type=="keydown"?this.key[t.key.toLowerCase()]=this.dkey[t.key.toLowerCase()]=Number(t.ctrlKey)+(Number(t.shiftKey)<<1)+(Number(t.altKey)<<2):(delete this.key[t.key.toLowerCase()],this.dkey[t.key.toLowerCase()]=-1))}reset(){this.dx=0,this.dy=0,this.db=0,this.dsx=0,this.dsy=0,this.drx=0,this.dry=0,this.dkey={}}constructor(t){this._eng=t}_eng;bind(t){this._cam=t,addEventListener("wheel",i=>this.handle(i)),addEventListener("mousemove",i=>this.handle(i)),addEventListener("mouseover",i=>this.handle(i)),addEventListener("mousedown",i=>this.handle(i)),addEventListener("mouseup",i=>this.handle(i)),addEventListener("mouseenter",i=>this.handle(i)),addEventListener("mouseout",i=>this.handle(i)),addEventListener("keydown",i=>this.handle(i)),addEventListener("keyup",i=>this.handle(i))}_cam},_=class{static res=[];render(t,i,s){return[]}eng=null;scene=null;constructor(...t){}},E=class{entities=[];add(...t){for(let i of t)i.eng=this.eng,this.entities.push(i)}remove(...t){for(let i=0;i<this.entities.length;i++)t.includes(this.entities[i])&&(this.entities.slice(i,1),i--)}show(t){t?t.scene=this:this.eng.cameras.length&&(this.eng.cameras[0].scene=this)}eng;constructor(t,...i){this.eng=t,this.add(...i)}},T=class{imgs={};fonts={};audios={};base="";load(t,...i){let s=[];for(let r of i)s.push(...r.res);this.load_res(t,...s)}load_res(t,...i){let s=[],r=!1,e=(a,l)=>{a==-1&&(this.load_err.push(this.base+i[l]),r=!0),s[l][0]=a,t(r?-1:s.map(d=>d[0]/d[1]).reduce((d,h)=>d+h)/s.length)},n=0;for(let a of i){let l=a.split(".").reverse()[0].toLowerCase();if(["png","jpg","jpeg"].includes(l)){s.push([0,1]);let d=new Image,h=n;d.onload=()=>e(1,h),d.onerror=()=>e(-1,h),d.src=this.base+a,this.imgs[a]=d}else if(["ttf","mp3","wav"].includes(l)){s.push([0,5]);let d=n,h=new XMLHttpRequest;h.open("GET",this.base+a),h.responseType="blob",h.onreadystatechange=()=>{if(e(h.readyState,d),h.readyState==4&&h.status!=200)return e(-1,d);if(!(h.readyState!=4||h.status!=200)){if(l=="ttf"){let o=this.fonts[a]=`font_${Object.keys(this.fonts).length}`,f=document.createElement("h1");f.style.font=`20px ${o}`,f.innerHTML=o,f.style.position="fixed",f.style.left="0",f.style.top="100%";let m=document.createElement("style");m.innerHTML+=`@font-face {font-family:"${o}";src:url("${URL.createObjectURL(h.response)}") format("truetype");}`,document.head.appendChild(m),document.body.appendChild(f);let p=y=>{document.fonts.check(`20px ${o}`)?e(5,d):y>1e3?e(-1,d):setTimeout(p,10,y+1)};p(0)}if(["mp3","wav"].includes(l)){this.audios[a]=new Audio;let o=this.audios[a];o.active=!1,o.src=URL.createObjectURL(h.response),o.volume=0,o.addEventListener("ended",()=>{o.currentTime=0,o.play()}),e(5,d)}else e(5,d)}},h.send()}else s.push([0,1]),this.error_add(new Error(`Unknown file type "${l}"`)),e(-1,n);n++}r||t(0)}errors=[];load_err=[];error_add(t){for(let i of this.errors)if(i.message==t.message)return;this.errors.push(t),console.log(t)}cameras=[];inp;debug={m:[1,0,0,1,0,0],_m:[1,0,0,1,0,0],mp:t=>{if(this.inp.key.a!=null&&(this.debug.m[0]-=t*(this.inp.key.a==0?1:this.inp.key.a&2?.25:0)),this.inp.key.d!=null&&(this.debug.m[0]+=t*(this.inp.key.d==0?1:this.inp.key.d&2?.25:0)),this.inp.key.q!=null&&(this.debug.m[1]-=t*(this.inp.key.q==0?1:this.inp.key.q&2?.25:0)),this.inp.key.e!=null&&(this.debug.m[1]+=t*(this.inp.key.e==0?1:this.inp.key.e&2?.25:0)),this.inp.key.s!=null&&(this.debug.m[3]-=t*(this.inp.key.s==0?1:this.inp.key.s&2?.25:0)),this.inp.key.w!=null&&(this.debug.m[3]+=t*(this.inp.key.w==0?1:this.inp.key.w&2?.25:0)),this.inp.key.x!=null&&(this.debug.m[2]-=t*(this.inp.key.x==0?1:this.inp.key.x&2?.25:0)),this.inp.key.z!=null&&(this.debug.m[2]+=t*(this.inp.key.z==0?1:this.inp.key.z&2?.25:0)),this.inp.key.c!=null&&(this.debug.m[4]-=t*(this.inp.key.c==0?4:this.inp.key.c&2?.25:0)),this.inp.key.v!=null&&(this.debug.m[4]+=t*(this.inp.key.v==0?4:this.inp.key.v&2?.25:0)),this.inp.key.r!=null&&(this.debug.m[5]-=t*(this.inp.key.r==0?4:this.inp.key.r&2?.25:0)),this.inp.key.f!=null&&(this.debug.m[5]+=t*(this.inp.key.f==0?4:this.inp.key.f&2?.25:0)),this.inp.key[1]!=null||this.inp.key[2]!=null){let i=Math.PI/16*t*(this.inp.key[1]!=null?1:-1),s=Math.cos(i),r=Math.sin(i),e=[...this.debug.m];this.debug.m=[e[0]*s+e[2]*r,e[1]*s+e[3]*r,e[2]*s-e[0]*r,e[3]*s-e[1]*r,e[4],e[5]]}if(!Object.keys(this.inp.key).length){for(let i=0;i<6;i++)if(this.debug.m[i]!=this.debug._m[i]){console.log("DEBUG MATRIX:",this.debug.m.toString()),this.debug._m=[...this.debug.m];break}}}};_wait=0;_times=[];_start;get fps(){return this._times.length}set fps(t){this._wait=t?2e3/t:0}scene=null;start_loop(t=!0){let i=performance.now(),s=this._times.length?i-this._times[this._times.length-1]:0;this._times=this._times.filter(e=>i-e<=1e3),this._times.push(i),t&&(this._start=i);for(let e in this.audios)this.audios[e].active=!1;let r=0;for(let e of this.cameras){if(e.cursor="default",e.clear(),e.fit&&e.fitfull(),e.scene!=null)for(let n of e.scene.entities)e.render(...n.render(s/1e3,i-this._start,e));e.dom.style.cursor=e.cursor,this.loop(s/1e3,i-this._start,e),r++}for(let e in this.audios){let n=this.audios[e];n.active&&n.paused?n.play():!n.active&&!n.paused&&n.pause(),console.log(n.paused)}this.inp.reset(),setTimeout(()=>this.start_loop(!1),this._wait-s>0?this._wait-s:0)}loop=()=>{};act=()=>{};constructor(){this.inp=new z(this),this.start_loop()}};var S=class extends _{per=0;render(t,i,s){return this.eng==null?[]:(console.log(this.per),[{c:0},{p:[[-100,-10],[],[200,20],[]],b:this.per<0?"red":"white",bz:2,x:s.w/2,y:s.h/2},{a:this.per<0?0:1,p:[[-96,-6],[],[192*this.per,12],[]],f:"white",x:s.w/2,y:s.h/2},{t:this.per<0?"Error loading assets":"Loading...",f:this.per<0?"red":"white",x:s.w/2,y:s.h/2-30},{a:this.per<0?.75:0,t:`failed: ${this.eng.load_err[this.eng.load_err.length-1]}`,tz:15,f:"red",x:s.w/2,y:s.h/2+30}])}};var M=class u extends _{static res=["coins.png","ui/title.png","ui/resume.png","ui/options.png","ui/exit.png","ui/close.png","ui/menu.png","font/emulogic.ttf","music/bgm1_prototype.wav"];money=1e3;menu=0;m=0;render(t,i,s){if(this.eng==null)return[];this.m+=(this.menu-this.m)*t*10;let r=(...n)=>n.map(a=>Math.max(0,1-Math.abs(this.m-a))).reduce((a,l)=>a+l,0),e=Math.floor(i/200)%4;return[{c:0,hover:n=>{n.click&&(n.cur="pointer")}},{aud:"music/bgm1_prototype.wav"},{f:"black",p:[[0,0],[],[s.w,s.h]],a:.25*r(0,2)},{x:s.w*.5,y:s.h*.25*(2*r(0)-1),f:u.res[1],s:.35},{f:u.res[0],x:(s.w*.72+25)*r(0)+50*r(1)-25,y:(s.h*.2+25)*r(0)+50*r(1)-25,crop:[Math.abs(2-e)*22,0,22,23],s:1.5,sx:e==1?-1.5:1.5},{t:String(this.money),tz:20,tf:"font/emulogic.ttf",x:44,y:38*r(1)-10,o:"w",f:"gold",b:"black"},{t:String(this.eng.fps),o:"nw",tz:8},{f:u.res[2],x:s.w/2,y:s.h-200*r(0)+50,s:.5,p:[[-73,-25],[],[155,48],[]],click:n=>this.menu=1},{f:u.res[3],x:s.w/2,y:s.h-200*r(0)+105,s:.5},{f:u.res[4],x:s.w/2,y:s.h-200*r(0)+160,s:.5,p:[[-73,-25],[],[155,48],[]],click:n=>{s.tile({f:"black"}),s.scene=null,n.cur="default"}},{f:"ui/menu.png",o:"ne",x:s.w+(30-40*r(1)),y:10,s:.25,p:[[-30,0],[],[30,30],[]],click:n=>this.menu=0},{f:"ui/close.png",o:"ne",x:s.w+(70-40*(2-Math.abs(2-this.m))),y:10,s:.25,p:[[-30,0],[],[30,30],[]],click:n=>this.menu=1}]}};var $=class extends _{static res=["tile/grass_0.png","tile/sand_0.png","tile/sand1.png","tile/water.png","tile/ws_x_0.png","tile/ws_y_0.png","tile/ws_xy_0.png","tile/ws__0.png","tile/ws_x_1.png","tile/ws_y_1.png","tile/ws_xy_1.png","tile/test.png","road/dirt.png","road/dirt_empty.png","road/cement.png","road/cement_empty.png","building/fishing.png","building/callereal.png","building/bank.png","building/farm.png","building/factory.png","prop/tree.png","ocean.png"];bg={};rd={};bd={};tile(t,i){return{x:t*72+i*64,y:i*36-t*19}}set_tile(t,i,s=0,r=0,e=1,n=1){let a="",l={},d=(h,o,f)=>{let m=`${s+o}_${r+f}`,p=0;i[m]&&i[m].data&&i[m].data.p&&(p=i[m].data.p);let y=structuredClone(t[p|h]);y.f||(y.f="tile/test.png"),y.data={...i[m]?.data||{},...t[p|h]?.data||{},p:p|h},i[m]=y};for(let h=0;h<e;h++)for(let o=0;o<n;o++)d(15,h,o);for(let h=0;h<e;h++)d(3,h,-1);for(let h=0;h<e;h++)d(12,h,n);for(let h=0;h<n;h++)d(5,-1,h);for(let h=0;h<n;h++)d(10,e,h);d(1,-1,-1),d(2,e,-1),d(4,-1,n),d(8,e,n)}generate(t=[]){let i=(e,n)=>e+13*n+71,s={};this.rd={};let r={};this.bd={};for(let e of t)if(e.w==null&&(e.w=1),e.h==null&&(e.h=1),e.type=="sand")this.set_tile([{},{data:{pre:"ws_xy"},m:[.312,.463,-2.45,-.23,-1,1]},{data:{pre:"ws_xy"},m:[-1,0,0,-1,-1,1]},{data:{pre:"ws_y"},m:[-1,0,0,-1,-1,1]},{data:{pre:"ws_xy"}},{data:{pre:"ws_x"}},{},{data:{pre:"ws_"},m:[-.2404,-.45704,2.5288,.2536,0,0]},{data:{pre:"ws_xy"},m:[-.355,.37,2.31,.38,-1,1]},{},{data:{pre:"ws_x"},m:[-1,0,0,-1,-1,1]},{data:{pre:"ws_"},m:[1,0,0,1,-2,0]},{data:{pre:"ws_y"}},{data:{pre:"ws_"},m:[.95175,.235,.275,-.951,0,.6285]},{data:{pre:"ws_"},m:[.26139,.4746,-2.4687,-.27096,4.952,2.076]},{data:{pre:"sand"}}],r,e.x,e.y,e.w,e.h);else if(e.type=="grass"){let n="";for(let a=0;a<e.w;a++)for(let l=0;l<e.h;l++)r[n=`${a+e.x}_${l+e.y}`]&&r[n].data?.pre=="sand"&&(r[n].data={...r[n].data||{},top:"grass"})}else if(e.type=="dirt")for(let n=0;n<e.w;n++){let a=`${e.v?e.x:e.x+n}_${e.v?e.y+n:e.y}`;a in s?s[a]={f:"road/dirt_empty.png",m:[1.33725,-.071745,-.24675,1.2205,0,0]}:a in r&&(s[a]={f:"road/dirt.png",m:e.v?[1.33725,-.071745,-.24675,1.2205,0,0]:[-1.27025,-.39275,0,1.2135,0,0]})}else if(e.type=="cement")for(let n=0;n<e.w;n++){let a=`${e.v?e.x:e.x+n}_${e.v?e.y+n:e.y}`;a in s?s[a]={f:"road/cement_empty.png",m:[1.33725,-.071745,-.24675,1.2205,0,0]}:a in r&&(s[a]={f:"road/cement.png",m:e.v?[1.33725,-.071745,-.24675,1.2205,0,0]:[-1.27025,-.39275,0,1.2135,0,0]})}else e.type=="fishing"?s[`${e.x}_${e.y}`]={f:"building/fishing.png",s:.75,m:[1,0,0,1,5,-35],p:[[-70,-80],[],[145,110],[]],click:n=>this.eng?.act("building")}:e.type=="callereal"?s[`${e.x}_${e.y}`]={f:"building/callereal.png",p:[[-85,-140],[],[185,160],[]],m:[1,0,0,1,0,-60],click:n=>this.eng?.act("building")}:e.type=="bank"?s[`${e.x}_${e.y}`]={f:"building/bank.png",p:[[-62,-100],[],[133,130],[]],m:[1,0,0,1,4,-32],click:n=>this.eng?.act("building")}:e.type=="farm"?s[`${e.x}_${e.y}`]={f:"building/farm.png",p:[[-62,-100],[],[133,130],[]],click:n=>this.eng?.act("building")}:e.type=="factory"?s[`${e.x}_${e.y}`]={f:"building/factory.png",p:[[-62,-100],[],[133,130],[]],s:.5,m:[1,0,0,1,0,-50],click:n=>this.eng?.act("building")}:e.type=="tree"?s[`${e.x}_${e.y}`]={f:"prop/tree.png",p:[[-62,-100],[],[133,130],[]],s:.08}:this.eng?.error_add(new Error(`Unknown type "${e.type}`));for(let e in r){let n=e.split("_").map(a=>Number(a));Object.assign(r[e],this.tile(n[0],n[1])),r[e].data?.pre&&(r[e].f=`tile/${r[e].data.top||r[e].data.pre}_0.png`)}for(let e in s){let n=e.split("_").map(a=>Number(a));Object.assign(s[e],this.tile(n[0],n[1]))}this.bg=r,this.rd=s}init=!0;render(t,i,s){return s.tile({f:"ocean.png",s:1}),[{hover:r=>{r.click&&this.eng?.act("onmap?")&&(r.cur="pointer")}},...Object.values(this.bg),...Object.values(this.rd),{f:"tile/test.png",...this.tile(-1,0),a:.5}]}};var x=new T;x.base="/assets/";var C=new j("#game",x);C.fit=!0;C.s=2;C.y=0;C.x=-150;var R=[{type:"sand",x:-10,y:-10,w:20,h:20},{type:"grass",x:-9,y:-9,w:18,h:18},{type:"fishing",x:7,y:9},{type:"dirt",x:3,y:-8,w:16,v:!0},{type:"cement",x:-8,y:1,w:16},{type:"bank",x:2,y:0},{type:"tree",x:1.6,y:0},{type:"callereal",x:0,y:0},{type:"farm",x:-1,y:0},{type:"factory",x:-3,y:0}];for(let u=0;u<10;u++)for(let t=0;t<10;t++)R.push({type:"tree",x:-8+t*.5+(Math.random()-.5),y:-8+u*.5+(Math.random()-.5)});var H=new S,B=new E(x,H);B.show(C);var q=new $(x);q.generate(R);var w=new M;w.menu=1;var I=new E(x,q,w);x.act=(u,...t)=>{if(u=="building")w.menu==1&&(w.menu=2);else if(u=="onmap?")return w.menu==1};x.load(u=>{H.per=u,u==1&&I.show()},M,$);x.loop=(u,t,i)=>{if(w.menu==0)return;let s=x.inp;if(s.dsy){let r=Math.max(.25,Math.min(8,i.sx*Math.pow(2,-s.dsy/100)));i.s=r}if(w.menu==1&&(s.cb(1)&&s.dx&&s.dy,s.b&1)){i.x-=s.dx/i.sx,i.y-=s.dy/i.sy;let r=1300*Math.min(1,i.sx),e=600*Math.min(1,i.sy);i.x=Math.min(r,Math.max(-r,i.x)),i.y=Math.min(e,Math.max(-e,i.y))}};})();</script></body></html>