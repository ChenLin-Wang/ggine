<!DOCTYPE html><html><head><title>Noble City</title><style>html,body{background-color:#111;width:100%;height:100%;margin:0;padding:0;overflow:hidden;display:flex;justify-content:center;align-items:center;}canvas{display:block;image-rendering:pixelated;object-fit:contain;box-shadow:0 0 30px #000}</style></head><body><canvas id="game"></canvas><script>(()=>{var B=class{x=0;y=0;sm=1;get w(){return Math.floor(this.dom.width/this.sm)}set w(e){this.dom.width=e}get h(){return Math.floor(this.dom.height/this.sm)}set h(e){this.dom.height=e}set s(e){this.sx=e,this.sy=e}sx=1;sy=1;scale(e){this.dom.width*=e,this.dom.height*=e,this._ctx=this.dom.getContext("2d"),this._ctx.imageSmoothingEnabled=!1,this._ctx.scale(e,e),this.sm*=e}full(){document.body.requestFullscreen()}def={bz:1};cursor="default";tolisten=[];render(e={},...r){let i=this._eng;r.length||(r=[e],e={});for(let n of r){this._ctx.save();let t={};if(Object.assign(t,this.def,e,n),(t.click||t.hover||t.press)&&t.p!=null&&this.tolisten.push(t),t.f&&t.f in i.audios){i.audios[t.f].active=!0,i.audios[t.f].volume=t.a??1;continue}let a=t.f!=null&&!(t.f in i.imgs),s=t.b!=null&&!(t.b in i.imgs),p=t.crop!=null&&t.crop.length==4,m=t.crop!=null&&t.crop.length==8;a&&(this._ctx.fillStyle=t.f),s&&(this._ctx.strokeStyle=t.b),this._ctx.lineCap=t.be=="arc"?"round":t.be=="sqr"?"square":"butt",this._ctx.lineJoin=t.bj=="arc"?"round":t.bj=="sqr"?"bevel":"miter",this._ctx.lineWidth=t.bz??1,this._ctx.globalAlpha=t.a??1,t.c=t.c??1;let[h,l]=[Math.pow(this.sx,t.c),Math.pow(this.sy,t.c)];t.sx=(t.sx??t.s??1)*h,t.sy=(t.sy??t.s??1)*l;let[c,k]=t.r?[Math.sin(t.r),Math.cos(t.r)]:[0,1],[v,T]=[this.w/2*t.c*Math.pow(this.sx,t.c-1)+this.x*(1-t.c-h)+(t.x??0)*h,this.h/2*t.c*Math.pow(this.sy,t.c-1)+this.y*(1-t.c-l)+(t.y??0)*l],ie=this.rect(t);if(this._ctx.transform(t.sx*k,t.sx*c,-t.sy*c,t.sy*k,v,T),t.m&&t.m.length==6?this._ctx.transform.apply(this._ctx,t.m):t.m&&i.error_add(new Error(`Invalid transform [${t.m.toString()}]`)),this._ctx.translate(ie[0][0]/t.sx,ie[0][1]/t.sy),t.f!=null&&t.f in i.imgs){if(t.crop&&p)this._ctx.drawImage(i.imgs[t.f],t.crop[0],t.crop[1],t.crop[2],t.crop[3],0,0,t.crop[2],t.crop[3]);else if(t.crop&&m)for(let d=0;d<=t.crop[6];d++)for(let x=0;x<=t.crop[7];x++)this._ctx.drawImage(i.imgs[t.f],t.crop[0]*(d==0?0:d==t.crop[6]?1:.5),t.crop[1]*(x==0?0:x==t.crop[7]?1:.5),t.crop[2],t.crop[3],t.crop[4]*d,t.crop[5]*x,t.crop[2],t.crop[3]);else this._ctx.drawImage(i.imgs[t.f],0,0);t.p=t.p??ie}if(t.p){let d=0,x=0;this._ctx.beginPath();for(let b of t.p)b.length==2&&!d?this._ctx.moveTo(b[0],b[1]):b.length==2&&x==1?(this._ctx.lineTo(t.p[d-2][0]+b[0],t.p[d-2][1]),this._ctx.lineTo(t.p[d-2][0]+b[0],t.p[d-2][1]+b[1]),this._ctx.lineTo(t.p[d-2][0],t.p[d-2][1]+b[1])):b.length==2?this._ctx.lineTo(b[0],b[1]):b.length==0&&d>0&&t.p[d-1].length==2&&d+1!=t.p.length&&t.p[d+1].length==2?x=1:b.length==0&&d+1==t.p.length&&this._ctx.closePath(),d++;s&&this._ctx.stroke(),a&&(t.bz??1)&&this._ctx.fill()}if(t.t){let d=t.tz??20,[x,b]=[0,0],[pe,he]=[!1,!1];this._ctx.font=`${d}px ${t.tf&&t.tf in i.fonts?i.fonts[t.tf]:t.tf??"Arial"}`,(pe=[0,.5,1].includes(t.ox))&&(this._ctx.textAlign=t.ox==0?"start":t.ox==1?"end":"center"),(he=[0,.5,1].includes(t.oy))&&(this._ctx.textBaseline=t.oy==0?"top":t.oy==1?"bottom":"middle"),pe||(x=-this._ctx.measureText(t.t).width*t.ox),he||(b=-d*t.oy),s&&(t.bz??1)&&this._ctx.strokeText(t.t,x,b),a||(this._ctx.fillStyle="#000"),(!a&&!s||a)&&this._ctx.fillText(t.t,x,b)}this._ctx.restore()}}play(e,r=1,i=0){if(e in this._eng.audios){let n=new Audio;return n.src=this._eng.base+e,n.volume=r,n.currentTime=i,n.addEventListener("ended",()=>n=null),n.play(),!0}return!1}clear(){this._ctx.clearRect(0,0,this.w,this.h)}fit=!1;fitfull(){let{width:e,height:r}=(this.dom.parentElement||this.dom).getBoundingClientRect(),i=this.w/this.h;e/r>i?(this.dom.style.width="auto",this.dom.style.height="100%"):(this.dom.style.width="100%",this.dom.style.height="auto")}tile(e){let r=e.sx!=null?e.sx:e.s!=null?e.s:this.def.sx!=null?this.def.sx:this.def.s!=null?this.def.s:1,i=e.sy!=null?e.sy:e.s!=null?e.s:this.def.sy!=null?this.def.sy:this.def.s!=null?this.def.s:1,n=this.dom.getBoundingClientRect(),t=n.width/this.w,a=n.height/this.h;!e.f||!(e.f in this._eng.imgs)?e.f!=null&&(this.dom.style.background=e.f):(this.dom.style.backgroundImage=`url(${this._eng.base}${e.f})`,this.dom.style.backgroundPosition=`calc(50% + ${((e.x||0)-this.x)*this.sx*t}px) calc(50% + ${((e.y||0)-this.y)*this.sy*a}px)`,this.dom.style.backgroundSize=`${this._eng.imgs[e.f].width*this.sx*r}px ${this._eng.imgs[e.f].height*this.sy*i}px`)}rect(e){let r=e.f!=null&&!(e.f in this._eng.imgs),i=e.crop!=null&&e.crop.length==4,n=e.crop!=null&&e.crop.length==8;e.ox=e.ox??(!e.o||!e.o.includes("w")&&!e.o.includes("e")?.5:e.o&&e.o.includes("e")?1:0),e.oy=e.oy??(!e.o||!e.o.includes("n")&&!e.o.includes("s")?.5:e.o&&e.o.includes("s")?1:0);let t=e.crop&&i?[e.crop[2],e.crop[3]]:e.crop&&n?[e.crop[4]*(e.crop[6]+1),e.crop[5]*(e.crop[7]+1)]:e.f&&!r?[this._eng.imgs[e.f].width,this._eng.imgs[e.f].height]:[0,0];return[[t[0]*-(e.ox??.5)*(e.sx??e.s??1),t[1]*-(e.oy??.5)*(e.sy??e.s??1)],[],[t[0]*(e.sx??e.s??1),t[1]*(e.sy??e.s??1)],[]]}dom;scene=null;_ctx;_eng;constructor(e="",r,i=640,n=360){this.dom=typeof e!="string"?e:e.length&&document.querySelector(e)?document.querySelector(e):document.createElement("canvas"),this.dom.style.aspectRatio=`${i} / ${n}`,this.w=i,this.h=n,this._ctx=this.dom.getContext("2d"),this._ctx.imageSmoothingEnabled=!1,this._eng=r,r.cameras.push(this),r.inp.bind(this)}},re=class{x=0;_x=0;_gx=0;get dx(){return this.x-this._x}set dx(e){this._x=this.x-e}y=0;_y=0;_gy=0;get dy(){return this.y-this._y}set dy(e){this._y=this.y-e}rx=0;_rx=0;_grx=0;get drx(){return this.rx-this._rx}set drx(e){this._rx=this.rx-e}ry=0;_ry=0;_gry=0;get dry(){return this.ry-this._ry}set dry(e){this._ry=this.ry-e}b=0;_b=0;get db(){return this.b^this._b}set db(e){this._b=this.b^e}cb(e,r=null){return(this.db&e)!=0&&(r==null?(this.b&e)!=0:(this.b&e)==r)}sx=0;_sx=0;get dsx(){return this.sx-this._sx}set dsx(e){this._sx=this.sx-e}sy=0;_sy=0;get dsy(){return this.sy-this._sy}set dsy(e){this._sy=this.sy-e}get gx(){return this.x-this._gx}get gy(){return this.y-this._gy}get grx(){return this.rx-this._grx}get gry(){return this.ry-this._gry}get g(){return Math.hypot(this.gx,this.gy)}get gr(){return Math.hypot(this.grx,this.gry)}click(e=1){return this.g<e&&this.cb(1,0)}over(e,r=[0,0],i){let n=i??(this._cam.def.c!=null?this._cam.def.c:1),t=(this.x-this._cam.w/2*n+this._cam.x*n*this._cam.sx)*Math.pow(this._cam.sx,-n)-r[0],a=(this.y-this._cam.h/2*n+this._cam.y*n*this._cam.sy)*Math.pow(this._cam.sy,-n)-r[1],s=!1;for(let p=0,m=e.length-1;p<e.length;m=p++){let h=e[p].length==2&&e[m].length==2;if(p==0&&e[m].length==0&&m--,p!=0&&p+1<e.length&&e[p].length==0&&e[p-1].length==2&&e[p+1].length==2){let l=e[p-1][0],c=e[p-1][1],k=l+e[p+1][0],v=c+e[p+1][1];c>a!=v>a&&l>t!=k>t&&(s=!s),p++}else if(h){let l=e[p][0],c=e[p][1],k=e[m][0],v=e[m][1];c>a!=v>a&&t<(k-l)*(a-c)/(v-c)+l&&(s=!s)}}return s}in(...e){for(let r of e)if(this.x>r[0]&&this.x<r[0]+r[2]&&this.y>r[1]&&this.y<r[1]+r[3])return!0;return!1}rin(...e){for(let r of e)if(this.rx>r[0]&&this.rx<r[0]+r[2]&&this.ry>r[1]&&this.ry<r[1]+r[3])return!0;return!1}key={};dkey={};handle(e){if(e instanceof WheelEvent)this.sx+=e.deltaX,this.sy+=e.deltaY;else if(e instanceof MouseEvent){let r=this._cam.dom.getBoundingClientRect(),i=this._cam.w/this._cam.h,n=i>r.width/r.height?[r.width,r.width/i]:[r.height*i,r.height];this.x=(e.clientX-r.left-(r.width-n[0])/2)/n[0]*this._cam.w,this.y=(e.clientY-r.top-(r.height-n[1])/2)/n[1]*this._cam.h,this.rx=(this.x-this._cam.w/2+this._cam.x)/this._cam.sx,this.ry=(this.y-this._cam.h/2+this._cam.y)/this._cam.sy,this.b=e.buttons,this.cb(1)&&(this._gx=this.x,this._gy=this.y,this._grx=this.rx,this._gry=this.ry),e.preventDefault()}else e instanceof KeyboardEvent&&(e.type=="keydown"?this.key[e.key.toLowerCase()]=this.dkey[e.key.toLowerCase()]=Number(e.ctrlKey)+(Number(e.shiftKey)<<1)+(Number(e.altKey)<<2):(delete this.key[e.key.toLowerCase()],this.dkey[e.key.toLowerCase()]=-1))}reset(){this.dx=0,this.dy=0,this.db=0,this.dsx=0,this.dsy=0,this.drx=0,this.dry=0,this.dkey={}}constructor(e){this._eng=e}_eng;bind(e){this._cam=e,addEventListener("wheel",r=>this.handle(r)),addEventListener("mousemove",r=>this.handle(r)),addEventListener("mouseover",r=>this.handle(r)),addEventListener("mousedown",r=>this.handle(r)),addEventListener("mouseup",r=>this.handle(r)),addEventListener("mouseenter",r=>this.handle(r)),addEventListener("mouseout",r=>this.handle(r)),addEventListener("keydown",r=>this.handle(r)),addEventListener("keyup",r=>this.handle(r))}_cam},_=class{static res=[];static depend=[];render(e,r,i){return[]}eng=null;scene=null;constructor(...e){}},I=class{entities=[];add(...e){for(let r of e)r.eng=this.eng,this.entities.push(r)}remove(...e){for(let r=0;r<this.entities.length;r++)e.includes(this.entities[r])&&(this.entities.slice(r,1),r--)}show(e){e?e.scene=this:this.eng.cameras.length&&(this.eng.cameras[0].scene=this)}eng;constructor(e,...r){this.eng=e,this.add(...r)}},j=class{imgs={};fonts={};audios={};base="";load(e,...r){let i=[];for(let n of r)i.push(...n.res),n.depend.length&&i.push(...this.load(null,...n.depend));return e!=null&&this.load_res(e,...i),i}load_res(e,...r){let i=[],n=!1,t=(s,p)=>{s==-1&&(this.load_err.push(this.base+r[p]),n=!0),i[p][0]=s,e(n?-1:i.map(m=>m[0]/m[1]).reduce((m,h)=>m+h)/i.length)},a=0;for(let s of r){if(s in this.imgs||s in this.fonts||s in this.audios){i.push([0,1]),t(1,a),a++;continue}let p=s.split(".").reverse()[0].toLowerCase();if(["png","jpg","jpeg"].includes(p)){i.push([0,1]);let m=new Image,h=a;m.onload=()=>t(1,h),m.onerror=()=>t(-1,h),m.src=this.base+s,this.imgs[s]=m}else if(["mp3","wav"].includes(p)){i.push([0,1]),this.audios[s]=new Audio;let m=a,h=this.audios[s];h.active=!1,h.oncanplaythrough=()=>t(1,m),h.onerror=()=>t(-1,m),h.src=this.base+s,h.volume=0,h.addEventListener("ended",()=>{h.currentTime=0,h.play()}),h.load()}else if(["ttf","mp3","wav"].includes(p)){i.push([0,5]);let m=a,h=new XMLHttpRequest;h.open("GET",this.base+s),h.responseType="blob",h.onreadystatechange=()=>{if(t(h.readyState,m),h.readyState==4&&h.status!=200)return t(-1,m);if(!(h.readyState!=4||h.status!=200)){if(p=="ttf"){let l=this.fonts[s]=`font_${Object.keys(this.fonts).length}`,c=document.createElement("h1");c.style.font=`20px ${l}`,c.innerHTML=l,c.style.position="fixed",c.style.left="0",c.style.top="100%";let k=document.createElement("style");k.innerHTML+=`@font-face {font-family:"${l}";src:url("${URL.createObjectURL(h.response)}") format("truetype");}`,document.head.appendChild(k),document.body.appendChild(c);let v=T=>{document.fonts.check(`20px ${l}`)?t(5,m):T>1e3?t(-1,m):setTimeout(v,10,T+1)};v(0)}if(["mp3","wav"].includes(p)){this.audios[s]=new Audio;let l=this.audios[s];l.active=!1,l.src=URL.createObjectURL(h.response),l.volume=0,l.addEventListener("ended",()=>{l.currentTime=0,l.play()}),t(5,m)}else t(5,m)}},h.send()}else i.push([0,1]),this.error_add(new Error(`Unknown file type "${p}"`)),t(-1,a);a++}n||e(0)}errors=[];load_err=[];error_add(e){for(let r of this.errors)if(r.message==e.message)return;this.errors.push(e),console.log(e)}cameras=[];inp;debug={m:[1,0,0,1,0,0],_m:[1,0,0,1,0,0],mp:e=>{if(this.inp.key.a!=null&&(this.debug.m[0]-=e*(this.inp.key.a==0?1:this.inp.key.a&2?.25:0)),this.inp.key.d!=null&&(this.debug.m[0]+=e*(this.inp.key.d==0?1:this.inp.key.d&2?.25:0)),this.inp.key.q!=null&&(this.debug.m[1]-=e*(this.inp.key.q==0?1:this.inp.key.q&2?.25:0)),this.inp.key.e!=null&&(this.debug.m[1]+=e*(this.inp.key.e==0?1:this.inp.key.e&2?.25:0)),this.inp.key.x!=null&&(this.debug.m[2]-=e*(this.inp.key.x==0?1:this.inp.key.x&2?.25:0)),this.inp.key.z!=null&&(this.debug.m[2]+=e*(this.inp.key.z==0?1:this.inp.key.z&2?.25:0)),this.inp.key.s!=null&&(this.debug.m[3]-=e*(this.inp.key.s==0?1:this.inp.key.s&2?.25:0)),this.inp.key.w!=null&&(this.debug.m[3]+=e*(this.inp.key.w==0?1:this.inp.key.w&2?.25:0)),this.inp.key.c!=null&&(this.debug.m[4]-=e*(this.inp.key.c==0?4:this.inp.key.c&2?.25:0)),this.inp.key.v!=null&&(this.debug.m[4]+=e*(this.inp.key.v==0?4:this.inp.key.v&2?.25:0)),this.inp.key.r!=null&&(this.debug.m[5]-=e*(this.inp.key.r==0?4:this.inp.key.r&2?.25:0)),this.inp.key.f!=null&&(this.debug.m[5]+=e*(this.inp.key.f==0?4:this.inp.key.f&2?.25:0)),this.inp.key[1]!=null||this.inp.key[2]!=null){let r=Math.PI/16*e*(this.inp.key[1]!=null?1:-1),i=Math.cos(r),n=Math.sin(r),t=[...this.debug.m];this.debug.m=[t[0]*i+t[2]*n,t[1]*i+t[3]*n,t[2]*i-t[0]*n,t[3]*i-t[1]*n,t[4],t[5]]}if(!Object.keys(this.inp.key).length){for(let r=0;r<6;r++)if(this.debug.m[r]!=this.debug._m[r]){console.log("DEBUG MATRIX:",this.debug.m.toString()),this.debug._m=[...this.debug.m];break}}},v:1,vp:e=>{this.inp.key.a!=null&&(this.debug.v-=e*(this.inp.key.a==0?1:this.inp.key.a&2?.25:0)),this.inp.key.d!=null&&(this.debug.v+=e*(this.inp.key.d==0?1:this.inp.key.d&2?.25:0)),console.log(this.debug.v)}};_wait=0;_times=[];_start;get fps(){return this._times.length}set fps(e){this._wait=e?2e3/e:0}scene=null;start_loop(e=!0){let r=performance.now(),i=this._times.length?r-this._times[this._times.length-1]:0;this._times=this._times.filter(t=>r-t<=1e3),this._times.push(r),e&&(this._start=r);for(let t in this.audios)this.audios[t].active=!1;let n=0;for(let t of this.cameras){t.cursor="default",t.clear(),t.fit&&t.fitfull(),t.tolisten=[];let a=[];if(t.scene!=null)for(let m of t.scene.entities){let h=w(m.render(i/1e3,r-this._start,t));for(let l of h)a.push(l)}let s=0,p=0;for(let m=a.length-1;m>=0;m--){let h=a[m];!h.hover&&!h.press&&!h.click||(h.p==null&&(h.p=t.rect(h)),this.inp.over(h.p,[h.x??0,h.y??0],h.c??1)&&(p==0&&h.hover&&h.hover(h),s==0&&h.click&&this.inp.click()&&(h.click(h),s++),h.press&&this.inp.b&1&&this.inp.g<1&&h.press(h)))}t.render({},...a),t.dom.style.cursor=t.cursor,this.loop(i/1e3,r-this._start,t),n++}for(let t in this.audios){let a=this.audios[t];a.active&&a.paused?a.play():!a.active&&!a.paused&&(a.currentTime=0,a.pause())}this.inp.reset(),setTimeout(()=>this.start_loop(!1),this._wait-i>0?this._wait-i:0)}loop=()=>{};constructor(){this.inp=new re(this),this.start_loop()}};function w(o){if(!o.length)return o;let[e,...r]=o,i=[];for(let n of r)i.push({...e,...n});return i}function me(o,e,r=0,i=0,n=1,t=1){let a=(s,p,m)=>{let h=`${r+p}_${i+m}`,l=0;e[h]&&e[h].data&&e[h].data.p&&(l=e[h].data.p);let c=structuredClone(o[l|s]);c.f||(c.f="tile/test.png"),c.data={...e[h]?.data||{},...o[l|s]?.data||{},p:l|s},e[h]=c};for(let s=0;s<n;s++)for(let p=0;p<t;p++)a(15,s,p);for(let s=0;s<n;s++)a(3,s,-1);for(let s=0;s<n;s++)a(12,s,t);for(let s=0;s<t;s++)a(5,-1,s);for(let s=0;s<t;s++)a(10,n,s);a(1,-1,-1),a(2,n,-1),a(4,-1,t),a(8,n,t)}var S=class extends _{per=0;start=()=>{};render(e,r,i){return this.eng==null?[]:[{c:0},...this.per!=1?[{p:[[-100,-10],[],[200,20],[]],b:this.per<0?"red":"white",bz:2,x:i.w/2,y:i.h/2},{a:this.per<0?0:1,p:[[-96,-6],[],[192*this.per,12],[]],f:"white",x:i.w/2,y:i.h/2},{t:this.per<0?"Error loading assets":"Loading...",f:this.per<0?"red":"white",x:i.w/2,y:i.h/2-30},{a:this.per<0?.75:0,t:`failed: ${this.eng.load_err[this.eng.load_err.length-1]}`,tz:15,f:"red",x:i.w/2,y:i.h/2+30}]:[{x:i.w/2,y:i.h/2,t:"Click to start game",f:"white"},{p:[[0,0],[],[i.w,i.h],[]],click:n=>this.start()}]]}};var g=class extends _{static key="";item="";focused=!1;own=1;price=0;on_focused=()=>{};popup=[];x;y;name="Building";base(e,r,i,n=1){this._c+=((this.focused?0:1)-this._c)*e*10;let t=this._c;return{c:t,x:this.x*t+.25*i.w*(1-t),y:this.y*t+.6*i.h*(1-t),s:n*t+1*(1-t),click:a=>{this.focused=!0,this.on_focused(this)}}}_c=1;render_pin(e,r,i,n=1){return this.popup.length==0?[]:[{x:this.x,y:this.y-100},{f:"ui/pin.png",s:.25,oy:.4,click:t=>{this.focused=!0,this.on_focused(this)}},...this.popup]}menu(e,r,i,n){return[]}constructor(e,r,i,n){super(),this.eng=e.eng,this.x=r*72+i*64,this.y=i*36-r*19}};var ne=class{money=0;own=[];item=[];saving=0;loan=0;logs=[[],[]];last=0;day=0;update(){performance.now()-this.last<1e3||(this.logs[0].push(this.saving),this.logs[1].push(this.loan),this.last=performance.now(),this.logs[0]=this.logs[0].slice(-100),this.logs[1]=this.logs[1].slice(-100))}loaned(e){if(e<0&&this.money<-e)return z([{t:"Insufficent funds ",f:"#F44336",tz:15}]);if(this.loan>1e5)return z([{t:"Reached Max loaned",f:"#F44336",tz:15}]);this.loan+e>1e5&&(z([{t:"Reached Max loaned",f:"black",tz:15}]),e=1e5-this.loan),this.money+=e,this.loan+=e}saved(e){if(e<0&&this.saving<-e)return z([{t:"Insufficent savings ",f:"#F44336",tz:15}]);if(this.money<e)return z([{t:"Insufficent funds",f:"#F44336",tz:15}]);this.money-=e,this.saving+=e}purchase(e){if(this.money<e.price)return z([{t:"Insufficent funds",f:"#F44336",tz:15}]);this.money-=e.price,e.own=2,this.own.push(e)}},f=new ne;var u=class extends _{name="";quantity=0;price=0;base(e,r,i,n=1){return{c:0}}menu(e,r,i){return[]}constructor(){super()}};var F=class extends u{static res=["item/beef.png"];name="Beef";price=400;render(e,r,i){return[this.base(e,r,i),{f:"item/beef.png",s:.125,m:[1,0,0,1,0,-90]}]}};var R=class extends u{static res=["item/carrot.png"];name="Carrot";price=130;render(e,r,i){return[this.base(e,r,i),{f:"item/carrot.png",s:.125,m:[1,0,0,1,0,-70]}]}};var q=class extends u{static res=["item/chicken.png"];name="Chicken";price=185;render(e,r,i){return[this.base(e,r,i),{f:"item/chicken.png",s:.125,m:[1,0,0,1,0,-90]}]}};var H=class extends u{static res=["item/fertilizer.png"];name="Fertilizer";price=32;render(e,r,i){return[this.base(e,r,i),{f:"item/fertilizer.png",s:.125,m:[1,0,0,1,0,-70]}]}};var A=class extends u{static res=["item/fish.png"];name="Fish";price=175;render(e,r,i){return[this.base(e,r,i),{f:"item/fish.png",s:.125,m:[1,0,0,1,0,-70]}]}};var O=class extends u{static res=["item/garlic.png"];name="Garlic";price=250;render(e,r,i){return[this.base(e,r,i),{f:"item/garlic.png",s:.125,m:[1,0,0,1,0,-90]}]}};var P=class extends u{static res=["item/kadyos.png"];name="Kadyos";price=200;render(e,r,i){return[this.base(e,r,i),{f:"item/kadyos.png",s:.125,m:[1,0,0,1,0,-90]}]}};var U=class extends u{static res=["item/langka.png"];name="Langka";price=100;render(e,r,i){return[this.base(e,r,i),{f:"item/langka.png",s:.125,m:[1,0,0,1,0,-90]}]}};var X=class extends u{static res=["item/pork.png"];name="Pork";price=350;render(e,r,i){return[this.base(e,r,i),{f:"item/pork.png",s:.125,m:[1,0,0,1,0,-90]}]}};var D=class extends u{static res=["item/radish.png"];name="Radish";price=50;render(e,r,i){return[this.base(e,r,i),{f:"item/radish.png",s:.125,m:[1,0,0,1,0,-90]}]}};var K=class extends u{static res=["item/soup.png"];name="Soup";price=35;render(e,r,i){return[this.base(e,r,i),{f:"item/soup.png",s:.15,m:[1,0,0,1,0,-60]}]}};var Y=class extends u{static res=["item/tomato.png"];name="Tomato";price=80;render(e,r,i){return[this.base(e,r,i),{f:"item/tomato.png",s:.125,m:[1,0,0,1,0,-90]}]}};var N=class extends u{static res=["item/tuna.png"];name="Tuna";price=270;render(e,r,i){return[this.base(e,r,i),{f:"item/tuna.png",s:.15,m:[1,0,0,1,0,-60]}]}};var G=class extends u{static res=["item/worm.png"];name="Worm";price=650;render(e,r,i){return[this.base(e,r,i),{f:"item/worm.png",s:.125,m:[1,0,0,1,0,-90]}]}};var M=[A,F,R,q,H,O,P,U,X,D,K,Y,N,G];function y(o,e,r=1,i=1,n=0){let t=[];"t"in o&&(t.push({t:o.t,tz:o.tz??20,b:"black",bz:o.bz??4,x:o.x??0,y:(o.y??0)+3,f:o.f??"white"}),delete o.t,delete o.tz,delete o.f,delete o.bz),"f"in o&&(t.push({f:o.f,x:(o.x??0)+(o.data?.x??0),y:(o.y??0)+(o.data?.y??0),s:.25,o:o.o??"",r:o.r??0,a:n==3?.5:1}),delete o.f,delete o.r);let a=o.click;return"click"in o&&delete o.click,o.click=s=>{s.data&&s.data.disabled||(s.data?.button&&e.play("sfx/button.mp3",.25),a&&a(s))},[{f:n==3?"ui/button_disabled.png":n==2?"ui/button_down.png":"ui/button_up.png",s:.25,crop:[60,59,60,59,57,56,r,i],press:s=>{s.data&&s.data.button&&(s.f="ui/button_down.png")},...o,data:{...o.data??{},button:n==0,disabled:n==3}},...t]}var L=class o extends _{static res=["coins.png","ui/title.png","ui/resume.png","ui/options.png","ui/exit.png","ui/close.png","ui/menu.png","ui/bag.png","ui/next.png","font/emulogic.ttf","music/bgm1_prototype.wav","sfx/button.mp3","sfx/whoosh.mp3","ui/button_up.png","ui/button_down.png","ui/button_disabled.png","plan.png"];static depend=M;pop=[];pop_c=0;pop_t=0;help=0;help_c=0;closed=()=>{};popup(e){this.pop=e,this.pop_t=0}focused=()=>{};menu=0;m=0;focus=null;title="Inventory";render(e,r,i){if(this.eng==null)return[];if(this.pop_c+=((this.pop.length?1:0)-this.pop_c)*e*10,this.pop.length&&this.pop_t==0){this.pop_t=performance.now();for(let s of this.pop)s.c=s.c??0}this.pop.length&&performance.now()-this.pop_t>3e3&&(this.pop=[]),this.help_c+=(this.help-this.help_c)*e*10,this.eng.inp.dkey.q==0&&(this.help=1-this.help),this.m+=(this.menu-this.m)*e*10,this.menu!=2&&this.focus!=null&&Math.abs(this.m-2)>.99&&(this.focus=null);let n=(...s)=>s.map(p=>Math.max(0,1-Math.abs(this.m-p))).reduce((p,m)=>p+m,0),t=Math.floor(r/200)%4,a=(s,p=1,m=1,h=0)=>y(s,i,p,m,h);return[{c:0,hover:s=>{s.click&&(s.cur="pointer")},tf:"font/emulogic.ttf"},{f:"music/bgm1_prototype.wav"},{f:"black",p:[[0,0],[],[i.w,i.h]],a:.5*n(0,2),click:this.menu==1?void 0:()=>{}},...this.focus==null?[]:w(this.focus.render(e,r,i)),{x:i.w*.5,y:i.h*.25*(2*n(0)-1),f:o.res[1],s:.35},{f:"coins.png",x:(i.w*.72+25)*n(0)-50*n(0)+25,y:(i.h*.2+25)*n(0)-50*n(0)+25,crop:[Math.abs(2-t)*22,0,22,23],sx:t==1?-1.5:1.5,sy:1.5},{t:String(f.money),tz:20,x:44,y:28-38*n(0),o:"w",f:"gold",b:"black",bz:4},{t:String(f.day),tz:20,x:i.w-130,y:28-38*n(0,2),o:"e",f:"white"},{t:String(this.eng.fps),o:"nw",tz:8},...a({x:i.w/2,y:i.h-200*n(0)+50,t:"resume",f:"#4CAF50",click:s=>this.menu=1},10,2),...a({x:i.w/2,y:i.h-200*n(0)+105,t:"options",f:"#2196F3"},10,2),...a({x:i.w/2,y:i.h-200*n(0)+160,t:"exit",f:"#F44336"},10,2),...a({x:i.w+30-40*n(1),y:10,o:"ne",f:"ui/menu.png",click:s=>this.menu=0,data:{x:-3,y:9}}),...a({x:i.w+30-80*n(1),y:10,o:"ne",f:"ui/bag.png",click:s=>{this.title="Inventory",this.menu=2},data:{x:-7,y:7}}),...a({x:i.w+30-120*n(1),y:10,o:"ne",f:"ui/next.png",click:s=>{},data:{x:-10,y:9}}),...a({x:i.w+70-80*n(2),y:10,o:"ne",f:"ui/close.png",click:s=>{this.closed(),this.focus&&(this.focus.focused=!1),this.menu=1},data:{x:-4,y:6}}),...this.focus==null||this.title.toLowerCase()=="inventory"?[...a({x:i.w/2,y:i.h+150-(i.h/2+135)*n(2)},40,20,1),...Array(32).fill(0).map((s,p)=>{let m=p%8,h=Math.floor(p/8);return{c:0,f:"ui/button_down.png",s:.25,crop:[60,59,60,59,57,56,3,3],x:75+70*m,y:90+70*h+(i.h-50)*(1-n(2))}}),...f.own.map((s,p)=>{let m=p%8,h=Math.floor(p/8);return[...w(s.render(e,r,i)).map(l=>(l.c=0,l.x=75+70*m,l.y=100+70*h+(i.h-50)*(1-n(2)),l.s=.25,l.click=void 0,l)),{c:0,x:75+70*m,y:90+70*h+(i.h-50)*(1-n(2)),p:[[-28,-28],[],[58,57],[]],click:l=>{i.x=s.x,i.y=s.y,this.menu=1}}]}).flat(),...f.item.map((s,p)=>{let m=(p+f.own.length)%8,h=Math.floor((p+f.own.length)/8);return w(s.render(e,r,i)).map(l=>(l.x=75+70*m,l.y=100+70*h+(i.h-50)*(1-n(2)),l))}).flat()]:[...a({x:i.w+150-(i.w/2+5)*n(2),y:i.h/2+15},20,19,1),...a({x:i.w/4,y:i.h+25-(i.h/8+25)*n(2),...[{t:"Cant Own",f:"#F44336"},{t:"Purchase",f:"#4CAF50",click:s=>{this.focus instanceof g&&f.purchase(this.focus)}},{t:"Sell",f:"#2196F3"}][this.focus.own]??{t:"Unknown",f:"#F44336"}},15,2),...this.focus.price&&this.focus.own==1?[{t:`\u20B1${this.focus.price}`,x:i.w/4,y:i.h+25-(i.h/4+15)*n(2),f:"white",a:.75}]:[],...this.focus.menu(e,r,i,n(2)).map(s=>(s.c=s.c??0,s.x=(s.x??0)+i.w+150-(i.w/2+5)*n(2),s.y=(s.y??0)+i.h/2+15,s))],...this.title.toLowerCase()=="inventory"?[{t:this.title,tz:20,b:"black",bz:4,x:i.w/2,y:28*n(2)-10*(1-n(2)),f:"skyblue"}]:[{t:this.title,tz:15,b:"black",bz:4,x:i.w/4,y:70*n(2)-10*(1-n(2)),f:"skyblue"}],...a({x:i.w/2,y:50*this.pop_c-30,click:s=>this.pop=[]},22,3),...this.pop.map(s=>(s.x=i.w/2,s.y=50*this.pop_c-25,s)),{f:"plan.png",o:"nw",s:.5,y:i.h*(1-this.help_c)}]}};var W=class extends g{static res=["building/bank.png"];static key="bank";item="building/bank.png";own=0;name="DBO Bank";act_loan_pay=!1;act_save_out=!1;render(e,r,i){return[this.base(e,r,i),{f:"building/bank.png",p:[[-62,-100],[],[133,130],[]],m:[1,0,0,1,4,-32]}]}menu(e,r,i){let n=f.logs[0],t=f.logs[1],a=Math.max(100,Math.max(...n,...t));return[...y({x:0,y:-98},i,19,4,2),{p:n.length<2?[[0,55],[270,55]]:n.map((s,p)=>[270*p/(n.length-1),55*(1-s/a)]),b:"green",x:-135,y:-125,bz:2,a:.5},{p:t.length<2?[[0,55],[270,55]]:t.map((s,p)=>[270*p/(t.length-1),55*(1-s/a)]),b:"red",x:-135,y:-125,bz:2,a:.5},{t:"Savings (5% rate)",o:"w",x:-140,y:-30,f:"black",tz:10,a:.75},{t:String(f.saving),o:"w",x:-140,y:-10,f:"black",tz:15},...y({x:-100,y:15,t:"1,000",tz:15,f:"black",bz:0,click:s=>f.saved(1e3*(this.act_save_out?-1:1))},i,5,1),...y({x:0,y:15,t:"10,000",tz:15,f:"black",bz:0,click:s=>f.saved(1e4*(this.act_save_out?-1:1))},i,6,1),...y({x:100,y:15,t:"100k",tz:15,f:"black",bz:0,click:s=>f.saved(1e5*(this.act_save_out?-1:1))},i,5,1),...y({x:90,y:-20,t:this.act_save_out?"deposit":"withdraw",tz:10,f:"black",bz:0,click:s=>this.act_save_out=!this.act_save_out},i,6,1),{t:"Loans (8% rate)",o:"w",x:-140,y:70,f:"black",tz:10,a:.75},{t:String(f.loan),o:"w",x:-140,y:90,f:"black",tz:15},...y({x:-100,y:115,t:"1,000",tz:15,f:"black",bz:0,click:s=>f.loaned(1e3*(this.act_loan_pay?-1:1))},i,5,1),...y({x:0,y:115,t:"10,000",tz:15,f:"black",bz:0,click:s=>f.loaned(1e4*(this.act_loan_pay?-1:1))},i,6,1),...y({x:100,y:115,t:"100k",tz:15,f:"black",bz:0,click:s=>f.loaned(1e5*(this.act_loan_pay?-1:1))},i,5,1),...y({x:90,y:80,t:this.act_loan_pay?"take loan":"pay back",tz:10,f:"black",bz:0,click:s=>this.act_loan_pay=!this.act_loan_pay},i,6,1)]}};var J=class extends g{static res=["building/blank_mask.png"];static key="blank";item="building/blank_mask.png";own=0;name="Private building";color=["white","white","white"];render(e,r,i){let n=this.base(e,r,i);return[{x:n.x??0,y:n.y??0,c:n.c??1},{p:[[-45,-33],[0,-7],[50,-20],[50,11],[0,24],[-38,2],[-45,0],[]],f:this.color[0]},{p:[[-45,-65],[0,-39],[50,-52],[50,-20],[0,-7],[-45,-33],[]],f:this.color[1]},{p:[[-49,-69.5],[8,-85],[54,-58],[54,-54],[53,-53],[53,-50],[0,-36],[-47,-64],[-47,-65],[-49,-67],[]],f:this.color[2]},{f:"building/blank_mask.png",p:[[-48,-85],[],[102,110],[]],m:[1,0,0,1,0,-30],...n}]}constructor(e,r,i,n){super(e,r,i,n),n.color?.length==3&&(this.color=n.color)}};var Q=class extends g{static res=["building/callereal.png","ui/triangle.png"];static key="callereal";static depend=M;item="building/callereal.png";own=0;name="Calle Real";items=[];page=0;constructor(e,r,i,n){super(e,r,i,n);for(let t of M)this.items.push(new t)}render(e,r,i){return[this.base(e,r,i),{f:"building/callereal.png",p:[[-85,-140],[],[185,160],[]],m:[1,0,0,1,0,-60]}]}menu(e,r,i,n){return[...y({x:0,y:-98},i,19,4,2),...this.items.slice(4*this.page,4*(this.page+1)).map((t,a)=>[...y({x:0,y:-36+48*a},i,19,2),...w(t.render(e,r,i)).map(s=>(s.x=-120,s.y=-26+48*a,s)),{t:t.name,x:-100,y:-46+48*a,o:"nw",tz:15}]).flat(),...y({x:-170+40*(1-n),y:50,f:"ui/triangle.png",r:-Math.PI/2,click:t=>{this.page--}},i,1,1,this.page>0?0:3),...y({x:-170+40*(1-n),y:80,f:"ui/triangle.png",r:Math.PI/2,click:t=>{this.page++}},i,1,1,this.page*4+4<this.items.length?0:3)]}};var V=class extends g{static res=["building/factory.png"];static key="factory";item="building/factory.png";name="Factory";render(e,r,i){return[this.base(e,r,i),{f:"building/factory.png",p:[[-75,-125],[],[165,145],[]],m:[1,0,0,1,0,-50]}]}};var Z=class extends g{static res=["building/farm.png"];static key="farm";item="building/farm.png";name="Farm";price=5e4;render(e,r,i){return[this.base(e,r,i),{f:"building/farm.png",p:[[-64,-49],[],[120,97],[]],m:[1,0,0,1,0,-10]}]}};var ee=class extends g{static res=["building/fishing.png"];static key="fishing";item="building/fishing.png";name="Fishing Area";price=5e4;render(e,r,i){return[this.base(e,r,i,.75),{f:"building/fishing.png",m:[1,0,0,1,5,-35],p:[[-70,-80],[],[145,110],[]]}]}};var le=[W,J,Q,V,Z,ee];var $=class o extends _{static res=["tile/grass_0.png","tile/sand_0.png","tile/sand1.png","tile/water_0.png","tile/water_1.png","tile/ws_x_0.png","tile/ws_y_0.png","tile/ws_xy_0.png","tile/ws__0.png","tile/ws_x_1.png","tile/ws_y_1.png","tile/ws_xy_1.png","tile/ws__1.png","tile/test.png","road/dirt.png","road/dirt_empty.png","road/cement.png","road/cement_empty.png","prop/tree.png","prop/bush.png","tile/water_bg_0.png","tile/water_bg_1.png","ui/pin.png"];static depend=le;ly=[{},{}];focused=()=>{};generate(e=[]){this.ly=[{},{}];let[r,i]=this.ly;for(let n of e){let t=!0,a=`${n.x}_${n.y}`;if(n.w==null&&(n.w=1),n.h==null&&(n.h=1),n.type=="sand")me([{},{data:{pre:"ws_xy"},m:[.312,.463,-2.45,-.23,-1,1]},{data:{pre:"ws_xy"},m:[-1,0,0,-1,-1,1]},{data:{pre:"ws_y"},m:[-1,0,0,-1,-1,1]},{data:{pre:"ws_xy"}},{data:{pre:"ws_x"}},{},{data:{pre:"ws_"},m:[-.2404,-.45704,2.5288,.2536,0,0]},{data:{pre:"ws_xy"},m:[-.355,.37,2.31,.38,-1,1]},{},{data:{pre:"ws_x"},m:[-1,0,0,-1,-1,1]},{data:{pre:"ws_"},m:[1,0,0,1,-2,0]},{data:{pre:"ws_y"}},{data:{pre:"ws_"},m:[.95175,.235,.275,-.951,0,.6285]},{data:{pre:"ws_"},m:[.26139,.4746,-2.4687,-.27096,4.952,2.076]},{data:{pre:"sand"}}],r,n.x,n.y,n.w,n.h);else if(n.type=="grass"){let s="";for(let p=0;p<n.w;p++)for(let m=0;m<n.h;m++)r[s=`${p+n.x}_${m+n.y}`]&&r[s].data?.pre=="sand"&&(r[s].data={...r[s].data||{},top:"grass"})}else if(n.type=="dirt")for(let s=0;s<n.w;s++){let p=`${n.v?n.x:n.x+s}_${n.v?n.y+s:n.y}`;p in i?i[p]={f:"road/dirt_empty.png",m:[1.33725,-.071745,-.24675,1.2205,0,0]}:p in r&&(i[p]={f:"road/dirt.png",m:n.v?[1.33725,-.071745,-.24675,1.2205,0,0]:[-1.27025,-.39275,0,1.2135,0,0]})}else if(n.type=="cement")for(let s=0;s<n.w;s++){let p=`${n.v?n.x:n.x+s}_${n.v?n.y+s:n.y}`;p in i?i[p]={f:"road/cement_empty.png",m:[1.33725,-.071745,-.24675,1.2205,0,0]}:p in r&&(i[p]={f:"road/cement.png",m:n.v?[1.33725,-.071745,-.24675,1.2205,0,0]:[-1.27025,-.39275,0,1.2135,0,0]})}else n.type=="tree"?i[a]={f:"prop/tree.png",m:[1,0,0,1,0,-25]}:n.type=="bush"?i[a]={f:"prop/bush.png",s:.08}:n.type=="test"?i[a]={f:"tile/test.png",a:.5}:t=!1;if(!t){for(let s of o.depend)if(n.type==s.key){let p=new s(this,n.x,n.y,n);p.on_focused=m=>this.focused(m),i[a]={data:{build:p}},t=!0,f.own.push(p)}}t||this.eng?.error_add(new Error(`Unknown type "${n.type}`))}for(let n in this.ly)for(let t in this.ly[n]){let a=t.split("_").map(p=>Number(p)),s=this.ly[n][t];Object.assign(s,{x:a[0]*72+a[1]*64,y:a[1]*36-a[0]*19}),n=="0"&&s.data?.pre&&(s.f=`tile/${s.data.top||s.data.pre}_0.png`)}}init=!0;render(e,r,i){i.tile({f:`tile/water_bg_${Math.floor(r/800)%2}.png`,s:3});for(let n in this.ly[0]){let t=this.ly[0][n];t.data&&t.data.pre&&t.data.pre[0]=="w"&&!t.data.top&&(t.f=`tile/${t.data.pre}_${Math.floor(r/800)%2}.png`)}return[{hover:n=>{n.click&&(n.cur="pointer")}},...Object.values(this.ly[0]),...Object.values(this.ly[1]).map(n=>{if(n.data?.build){let t=n.data.build;return[...w(t.render(e,r,i)),...w(t.render_pin(e,r,i))]}return[n]}).reduce((n,t)=>[...n,...t],[])]}};var se=[{type:"sand",x:-10,y:-10,w:20,h:20},{type:"grass",x:-9,y:-9,w:18,h:18},{type:"fishing",x:7,y:9},{type:"dirt",x:3,y:-8,w:16,v:!0},{type:"cement",x:-8,y:1,w:16},{type:"bank",x:2,y:0},{type:"tree",x:1.3,y:.3},{type:"callereal",x:0,y:0},{type:"factory",x:-5,y:0},{type:"blank",x:5,y:0,color:["blue","brown","violet"]},{type:"blank",x:4,y:0,color:["red","yellow","green"]},{type:"bush",x:-2,y:0},{type:"test",x:-2,y:.001},{type:"farm",x:-2,y:0},{type:"tree",x:0,y:3},{type:"test",x:2,y:.001}];for(let o=0;o<10;o++)for(let e=0;e<10;e++)se.push({type:"tree",x:-8+e*.5+(Math.random()-.5),y:-8+o*.5+(Math.random()-.5)});var C=new j,te=new B("#game",C);C.base="/assets/";te.fit=!0;te.scale(4);for(let o of M)f.item.push(new o);var oe=new S,fe=new I(C,oe);C.load(o=>{oe.per=o,o==1&&ue.show()},L,$);fe.show();oe.start=()=>{te.full(),ue.show()};var ae=new $(C),E=new L,ue=new I(C,ae,E);ae.generate(se);ae.focused=o=>{te.play("sfx/whoosh.mp3",.25,.4),E.title=o.name,E.menu=2,E.focus=o};function z(o){return E.popup(o)}E.menu=1;C.loop=(o,e,r)=>{let i=C.inp;if(f.update(),E.menu==1){if(i.dsy){let n=Math.max(.25,Math.min(8,r.sx*Math.pow(1.5,-i.dsy/100)));r.s=n}if(i.cb(1)&&i.dx&&i.dy,i.b&1){r.x-=i.dx/r.sx,r.y-=i.dy/r.sy;let n=1300*Math.min(1,r.sx),t=600*Math.min(1,r.sy);r.x=Math.min(n,Math.max(-n,r.x)),r.y=Math.min(t,Math.max(-t,r.y))}}};})();</script></body></html>