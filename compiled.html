<!DOCTYPE html><html><head><title>Noble City</title><style>canvas{position:fixed;left:0;top:0;width:100%;height:100%;image-rendering:pixelated;object-fit:contain;box-shadow:0 0 30px #000;background-color:#111}</style></head><body><canvas id="game"></canvas><script>(()=>{var _=class{x=0;_x=0;y=0;_y=0;b=0;_b=0;sx=0;_sx=0;sy=0;_sy=0;rx=0;_rx=0;ry=0;_ry=0;set dx(t){this._x=this.x-t}set dy(t){this._y=this.y-t}set db(t){this._b=this.b^t}set dsx(t){this._sx=this.sx-t}set dsy(t){this._sy=this.sy-t}set drx(t){this._rx=this.rx-t}set dry(t){this._ry=this.ry-t}get dx(){if(this.x==this._x)return 0;let t=this.x-this._x;return this._x=this.x,t}get dy(){if(this.y==this._y)return 0;let t=this.y-this._y;return this._y=this.y,t}get db(){if(this.b==this._b)return 0;let t=this.b^this._b;return this._b=this.b,t}get dsx(){if(this.sx==this._sx)return 0;let t=this.sx-this._sx;return this._sx=this.sx,t}get dsy(){if(this.sy==this._sy)return 0;let t=this.sy-this._sy;return this._sy=this.sy,t}get drx(){if(this.rx==this._rx)return 0;let t=this.rx-this._rx;return this._rx=this.rx,t}get dry(){if(this.ry==this._ry)return 0;let t=this.ry-this._ry;return this._ry=this.ry,t}_gx=0;_game;constructor(t){this._game=t}handle(t){if(t instanceof WheelEvent)this.sx+=t.deltaX,this.sy+=t.deltaY;else if(t instanceof MouseEvent){let e=this._game.dom.getBoundingClientRect(),s=this._game.w/this._game.h,i=s>e.width/e.height?[e.width,e.width/s]:[e.height*s,e.height];this.x=(t.clientX-e.left-(e.width-i[0])/2)/i[0]*this._game.w,this.y=(t.clientY-e.top-(e.height-i[1])/2)/i[1]*this._game.h,this.rx=(this.x-this._game.w/2+this._game.camera.x)/this._game.camera.z,this.ry=(this.y-this._game.h/2+this._game.camera.y)/this._game.camera.z,this.b=t.buttons,t.preventDefault()}}listen(t){t.addEventListener("wheel",e=>this.handle(e)),t.addEventListener("mousemove",e=>this.handle(e)),t.addEventListener("mouseover",e=>this.handle(e)),t.addEventListener("mousedown",e=>this.handle(e)),t.addEventListener("mouseup",e=>this.handle(e)),t.addEventListener("mouseenter",e=>this.handle(e)),t.addEventListener("mouseout",e=>this.handle(e))}},a=class{obj={};static res=[];constructor(...t){}update(...t){for(let e of t)Object.assign(this.obj,e)}sprite(t,e){return this.obj}},f=class{dom;x;camera={x:0,y:0,z:1};_w;_h;_z=1;get w(){return this._w}set w(t){this._w=t,this.dom.setAttribute("width",String(t*this._z))}get h(){return this._h}set h(t){this._h=t,this.dom.setAttribute("height",String(t*this._z))}get z(){return this._z}set z(t){this.x.scale(t/this._z,t/this._z),this.dom.setAttribute("width",String(this._w*t)),this.dom.setAttribute("height",String(this._h*t)),this._z=t}imgs={};load_img(t,...e){let s=0;t(0,e.length);for(let i of e){let r=new Image;r.onload=()=>t(s==-1?-1:++s,e.length),r.onerror=()=>{s=-1,t(-1,e.length)},r.src=i,this.imgs[i]=r}}rect(t,e,s,i,r){this.x.fillStyle=t,this.x.fillRect(e,s,i,r)}img(t,e,s){this.x.drawImage(this.imgs[t],e,s)}sprite(t){this.x.save();let e=t.f!=null&&!(t.f in this.imgs),s=t.s!=null&&!(t.s in this.imgs),i=t.o!=null&&t.o.length==4;if(e&&(this.x.fillStyle=t.f),s&&(this.x.strokeStyle=t.s),t.c!=null&&t.c!=1){let r=1-t.c,h=Math.pow(this.camera.z,-r);this.x.transform(h,0,0,h,this.camera.x*r-this.w/2*r*h,this.camera.y*r-this.h/2*r*h)}if((!t.d||!t.d.includes("w")&&!t.d.includes("e"))&&t.o&&i&&this.x.translate(-t.o[2]/2,0),(!t.d||!t.d.includes("n")&&!t.d.includes("s"))&&t.o&&i&&this.x.translate(0,-t.o[3]/2),t.d&&t.d.includes("w")&&t.o&&i&&this.x.translate(-t.o[2],0),t.d&&t.d.includes("s")&&t.o&&i&&this.x.translate(0,-t.o[3]),t.x&&this.x.translate(t.x,0),t.y&&this.x.translate(0,t.y),t.f!=null&&t.f in this.imgs&&(t.o&&i?this.x.drawImage(this.imgs[t.f],t.o[0],t.o[1],t.o[2],t.o[3],0,0,t.o[2],t.o[3]):this.x.drawImage(this.imgs[t.f],0,0)),t.r&&t.r.length==4&&(e&&this.x.fillRect.apply(this.x,t.r),s&&this.x.strokeRect.apply(this.x,t.r)),t.p){let r=0;for(let h of t.p)h.length==2&&!r?this.x.moveTo(h[0],h[1]):h.length==2&&this.x.lineTo(h[0],h[1]),r++;e&&this.x.fill(),s&&this.x.stroke()}this.x.restore()}sprites(...t){this.x.save(),this.x.transform(this.camera.z,0,0,this.camera.z,this.w/2-this.camera.x*this.camera.z,this.h/2-this.camera.y*this.camera.z);for(let e of t)this.sprite(e);this.x.restore()}key={};mouse;listen(){addEventListener("keydown",t=>{this.key[t.key.toLowerCase()]=Number(t.ctrlKey)+Number(t.shiftKey)<<1+Number(t.altKey)<<2}),addEventListener("keyup",t=>{delete this.key[t.key.toLowerCase()]})}constructor(t="",e,s,i=1){this.dom=typeof t!="string"?t:t.length&&document.querySelector(t)?document.querySelector(t):document.createElement("canvas"),this.w=e,this.h=s,this.x=this.dom.getContext("2d"),this.mouse=new _(this),this.listen(),this.mouse.listen(window),this.z=i,this.x.imageSmoothingEnabled=!1}_wait=0;_times=[];_start;set fps(t){this._wait=t?2e3/t:0}get fps(){return this._times.length}entity=[];add(...t){for(let e of t)this.entity.push(e)}render(t=()=>{},e=!0){let s=performance.now(),i=this._times.length?s-this._times[this._times.length-1]:0;this._times=this._times.filter(r=>s-r<=1e3),this._times.push(s),e&&(this._start=s),this.x.save(),this.x.scale(this._z,this._z),t.call(this,i/1e3,s-this._start),this.x.restore();for(let r of this.entity)this.sprites(r.sprite(i/1e3,s-this._start));setTimeout(()=>this.render(t,!1),this._wait-i>0?this._wait-i:0)}};var g=class extends f{constructor(t="",e=480,s=270){super(t,e,s,1),this.fps=0}load(...t){let e=[];for(let s of t)e.push(...s.res);this.load_img((s,i)=>{s/i==1&&this.render(this.menu)},...e)}draw=(t,e)=>{};menu(t,e){let s=this.w,i=this.h,r=this.mouse.dsy;if(r){let m=Math.pow(2,-r/100);m=Math.min(8,this.camera.z*m)/this.camera.z,m=Math.max(.125,this.camera.z*m)/this.camera.z,this.camera.x+=(m-1)*this.mouse.rx,this.camera.y+=(m-1)*this.mouse.ry,this.camera.z*=m}this.mouse.db&&this.mouse.b&1&&(this.mouse.dx=0,this.mouse.dy=0),this.mouse.b&1&&(this.camera.x-=this.mouse.dx/this.camera.z,this.camera.y-=this.mouse.dy/this.camera.z);let h=100/this.camera.z*t;("d"in this.key||"a"in this.key)&&("w"in this.key||"s"in this.key)&&(h/=Math.sqrt(2)),"d"in this.key&&(this.camera.x+=h),"a"in this.key&&(this.camera.x-=h),"w"in this.key&&(this.camera.y-=h),"s"in this.key&&(this.camera.y+=h),this.rect("#4C7133",0,0,s,i),this.draw(t,e)}};var u=class n extends a{static res=["/src/coins.png"];constructor(t){super(),this.update({f:n.res[0],o:[0,0,22,23]},t)}sprite(t,e){return this.obj.o&&(this.obj.o[0]=Math.abs(2-Math.floor(e/100)%4)*22),this.obj}},o=class n extends a{static res=["/src/factory_new.png"];constructor(){super(),this.update({f:n.res[0]})}sprite(t,e){return this.obj}},d=class n extends a{static res=["/src/bank.png"];constructor(){super(),this.update({f:n.res[0]})}sprite(t,e){return this.obj}},b=class n extends a{static res=["/src/building2.png","/src/building_side.png"];constructor(){super(),this.update({f:n.res[0]})}sprite(t,e){return this.obj}},l=class n extends a{static res=["/src/tree.png"];constructor(){super(),this.update({f:n.res[0]})}sprite(t,e){return this.obj}},c=class n extends a{static res=["/src/fishing.png"];constructor(){super(),this.update({f:n.res[0]})}sprite(t,e){return this.obj}},x=class n extends a{static res=["/src/buildings.png"];constructor(){super(),this.update({f:n.res[0]})}sprite(t,e){return this.obj}},p=class n extends a{static res=["/src/farm.png"];constructor(){super(),this.update({f:n.res[0]})}sprite(t,e){return this.obj}};var y=new g("#game");y.load(u,o,d,b,l,c,x,p);var M=new u({c:0,d:"ne",x:5,y:5}),j=new o,w=new d;w.update({x:100});var v=new b;v.update({x:100,y:-900});var z=new l;z.update({x:1e3});var E=new c;E.update({x:-200});var k=new x;k.update({x:-2e3,y:-500});var L=new p;L.update({y:100});y.add(j,w,v,z,E,k,L,M);y.draw=(n,t)=>{y.sprites({f:"blue",r:[750,-500,800,1200]})};})();</script></body></html>