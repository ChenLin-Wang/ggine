<!DOCTYPE html><html><head><title>Noble City</title><style>canvas{position:fixed;left:0;top:0;width:100%;height:100%;image-rendering:pixelated;object-fit:contain;box-shadow:0 0 30px #000;background-color:#111}</style></head><body><canvas id="game"></canvas><script>(()=>{var p=class{x=0;_x=0;y=0;_y=0;b=0;_b=0;sx=0;_sx=0;sy=0;_sy=0;rx=0;_rx=0;ry=0;_ry=0;set dx(t){this._x=this.x-t}set dy(t){this._y=this.y-t}set db(t){this._b=this.b^t}set dsx(t){this._sx=this.sx-t}set dsy(t){this._sy=this.sy-t}set drx(t){this._rx=this.rx-t}set dry(t){this._ry=this.ry-t}get dx(){return this.x==this._x?0:this.x-this._x}get dy(){return this.y==this._y?0:this.y-this._y}get db(){return this.b==this._b?0:this.b^this._b}get dsx(){return this.sx==this._sx?0:this.sx-this._sx}get dsy(){return this.sy==this._sy?0:this.sy-this._sy}get drx(){return this.rx==this._rx?0:this.rx-this._rx}get dry(){return this.ry==this._ry?0:this.ry-this._ry}ab(t,e=null){return(this.db&t)!=0&&(this.b&t)==(e??t)}over(t){return this.x>t[0]&&this.x<t[0]+t[2]&&this.y>t[1]&&this.y<t[1]+t[3]}rover(t){return this.rx>t[0]&&this.rx<t[0]+t[2]&&this.ry>t[1]&&this.ry<t[1]+t[3]}_game;constructor(t){this._game=t}reset(){this.dx=0,this.dy=0,this.db=0,this.dsx=0,this.dsy=0,this.drx=0,this.dry=0}handle(t){if(t instanceof WheelEvent)this.sx+=t.deltaX,this.sy+=t.deltaY;else if(t instanceof MouseEvent){let e=this._game.dom.getBoundingClientRect(),i=this._game.w/this._game.h,s=i>e.width/e.height?[e.width,e.width/i]:[e.height*i,e.height];this.x=(t.clientX-e.left-(e.width-s[0])/2)/s[0]*this._game.w,this.y=(t.clientY-e.top-(e.height-s[1])/2)/s[1]*this._game.h,this.rx=(this.x-this._game.w/2+this._game.camera.x)/this._game.camera.z,this.ry=(this.y-this._game.h/2+this._game.camera.y)/this._game.camera.z,this.b=t.buttons,t.preventDefault()}}listen(t){t.addEventListener("wheel",e=>this.handle(e)),t.addEventListener("mousemove",e=>this.handle(e)),t.addEventListener("mouseover",e=>this.handle(e)),t.addEventListener("mousedown",e=>this.handle(e)),t.addEventListener("mouseup",e=>this.handle(e)),t.addEventListener("mouseenter",e=>this.handle(e)),t.addEventListener("mouseout",e=>this.handle(e))}},a=class{sprites=[];static res=[];constructor(...t){}render(t,e,i){return this.sprites}},l=class{dom;x;camera={x:0,y:0,z:1};_w;_h;_z=1;get w(){return this._w}set w(t){this._w=t,this.dom.setAttribute("width",String(t*this._z))}get h(){return this._h}set h(t){this._h=t,this.dom.setAttribute("height",String(t*this._z))}get z(){return this._z}set z(t){this.x.scale(t/this._z,t/this._z),this.dom.setAttribute("width",String(this._w*t)),this.dom.setAttribute("height",String(this._h*t)),this._z=t}imgs={};load_img(t,...e){let i=0;t(0,e.length);for(let s of e){let r=new Image;r.onload=()=>t(i==-1?-1:++i,e.length),r.onerror=()=>{i=-1,t(-1,e.length)},r.src=s,this.imgs[s]=r}}rect(t,e,i,s,r){this.x.fillStyle=t,this.x.fillRect(e,i,s,r)}img(t,e,i){this.x.drawImage(this.imgs[t],e,i)}sprite(t){this.x.save();let e=t.f!=null&&!(t.f in this.imgs),i=t.s!=null&&!(t.s in this.imgs),s=t.o!=null&&t.o.length==4;if(e&&(this.x.fillStyle=t.f),i&&(this.x.strokeStyle=t.s),this.x.lineWidth=t.w!=null?t.w:1,t.a!=null&&(this.x.globalAlpha=t.a),t.c!=0){let r=t.c==null?1:0,n=Math.pow(this.camera.z,r);this.x.transform(n,0,0,n,this.w/2*r*Math.pow(this.camera.z,r-1)+this.camera.x*(1-r-n),this.h/2*r*Math.pow(this.camera.z,r-1)+this.camera.y*(1-r-n))}if(this.x.textAlign="left",this.x.textBaseline="top",(!t.d||!t.d.includes("w")&&!t.d.includes("e"))&&(t.o&&s?this.x.translate(-t.o[2]/2,0):t.f&&!e&&this.x.translate(-this.imgs[t.f].width/2,0),this.x.textAlign="center"),(!t.d||!t.d.includes("n")&&!t.d.includes("s"))&&(t.o&&s?this.x.translate(0,-t.o[3]/2):t.f&&!e&&this.x.translate(0,-this.imgs[t.f].height/2),this.x.textBaseline="middle"),t.d&&t.d.includes("e")&&(t.o&&s&&this.x.translate(-t.o[2],0),this.x.textAlign="end"),t.d&&t.d.includes("s")&&(t.o&&s&&this.x.translate(0,-t.o[3]),this.x.textBaseline="bottom"),t.x&&this.x.translate(t.x,0),t.y&&this.x.translate(0,t.y),t.f!=null&&t.f in this.imgs&&(t.o&&s?this.x.drawImage(this.imgs[t.f],t.o[0],t.o[1],t.o[2],t.o[3],0,0,t.o[2],t.o[3]):this.x.drawImage(this.imgs[t.f],0,0)),t.r&&t.r.length==4&&(e&&this.x.fillRect.apply(this.x,t.r),i&&this.x.strokeRect.apply(this.x,t.r)),t.p){let r=0;this.x.beginPath();for(let n of t.p)n.length==2&&!r?this.x.moveTo(n[0],n[1]):n.length==2&&this.x.lineTo(n[0],n[1]),r++;console.log(t.p),e&&this.x.fill(),i&&this.x.stroke()}t.t&&(t.n&&(this.x.font=t.n),e||(this.x.fillStyle="#000"),(!e&&!i||e)&&this.x.fillText(t.t,0,0),i&&this.x.strokeText(t.t,0,0)),this.x.restore()}sprites(...t){for(let e of t)this.sprite(e)}key={};mouse;listen(){addEventListener("keydown",t=>{this.key[t.key.toLowerCase()]=Number(t.ctrlKey)+Number(t.shiftKey)<<1+Number(t.altKey)<<2}),addEventListener("keyup",t=>{delete this.key[t.key.toLowerCase()]})}constructor(t="",e,i,s=1){this.dom=typeof t!="string"?t:t.length&&document.querySelector(t)?document.querySelector(t):document.createElement("canvas"),this.w=e,this.h=i,this.x=this.dom.getContext("2d"),this.mouse=new p(this),this.listen(),this.mouse.listen(window),this.z=s,this.x.imageSmoothingEnabled=!1}_wait=0;_times=[];_start;set fps(t){this._wait=t?2e3/t:0}get fps(){return this._times.length}entity=[];add(...t){for(let e of t)this.entity.push(e)}render(t=()=>{},e=!0){let i=performance.now(),s=this._times.length?i-this._times[this._times.length-1]:0;this._times=this._times.filter(r=>i-r<=1e3),this._times.push(i),e&&(this._start=i),this.x.save(),this.x.scale(this._z,this._z),t.call(this,s/1e3,i-this._start),this.x.restore();for(let r of this.entity)this.sprites(...r.render(this,s/1e3,i-this._start));this.mouse.reset(),setTimeout(()=>this.render(t,!1),this._wait-s>0?this._wait-s:0)}};var d=class extends l{coins=0;popup=null;constructor(t="",e=480,i=270){super(t,e,i,1),this.fps=0}load(...t){let e=[];for(let i of t)e.push(...i.res);this.load_img((i,s)=>{i/s==1&&this.render(this.menu)},...e)}draw=(t,e)=>{};menu(t,e){let i=this.w,s=this.h,r=this.mouse.dsy;if(r){let o=Math.max(.125,Math.min(8,this.camera.z*Math.pow(2,-r/100)));this.camera.x=(this.mouse.rx*o+this.w/2-this.mouse.x)/o,this.camera.y=(this.mouse.ry*o+this.h/2-this.mouse.y)/o,this.camera.z=o}this.mouse.db&&this.mouse.b&1&&(this.mouse.dx=0,this.mouse.dy=0),this.mouse.b&1&&(this.camera.x-=this.mouse.dx/this.camera.z,this.camera.y-=this.mouse.dy/this.camera.z);let n=100/this.camera.z*t;("d"in this.key||"a"in this.key)&&("w"in this.key||"s"in this.key)&&(n/=Math.sqrt(2)),"d"in this.key&&(this.camera.x+=n),"a"in this.key&&(this.camera.x-=n),"w"in this.key&&(this.camera.y-=n),"s"in this.key&&(this.camera.y+=n),this.rect("#4C7133",0,0,i,s),this.draw(t,e)}};var u=class h extends a{static res=["/assets/coins.png"];menu=!1;render(t,e,i){let s=t.popup==this,r=t.popup==this?[50,50,t.w-100,t.h-100]:[t.w*.25+50,50,t.w*.75-100,t.h-100];return t.popup!=null?t.mouse.ab(1,0)&&!t.mouse.over(r)&&(t.popup=null):t.mouse.ab(1,0)&&t.mouse.over([t.w-28,5,23,23])&&(t.popup=this),[{c:0,f:h.res[0],o:[Math.abs(2-Math.floor(i/100)%4)*22,0,22,23],d:"nw",x:5,y:5},{c:0,t:String(t.coins),x:35,y:16,n:"18px Arial",d:"w"},{c:0,x:t.w-5,y:5,d:"ne",r:[-23,0,23,23],f:s?"blue":"skyblue"},...s?[{c:0,r:[0,0,t.w,t.h],f:"black",a:.75},{c:0,r,f:"gray"}]:t.popup!=null&&t.popup instanceof x?[{c:0,r:[0,0,t.w,t.h],f:"black",a:.75},{c:0,r,f:"gray"},{c:0,x:t.w*.1875,y:t.h*.5,f:t.popup.popup_pic},{c:0,x:t.w*.25+70,y:60,t:t.popup.popup_name}]:[]]}},x=class extends a{popup_pic="";popup_name=""},m=class h extends x{static res=["/assets/farm.png"];x=0;y=0;popup_pic=h.res[0];popup_name="Farm";render(t,e,i){return t.mouse.ab(1,0)&&t.mouse.rover([-70+this.x,-50+this.y,140,100])&&(t.popup=this),[{f:h.res[0],x:this.x,y:this.y},{f:"red",r:[-70,-50,140,100],a:0}]}},b=[u,m];var f=new d("#game");f.load(...b);var c=new u,_=new m;f.add(_,c);})();</script></body></html>